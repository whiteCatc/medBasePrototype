{% extends 'core/base.html' %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
{% block title %}Perfil{% endblock %}

{% block header%}
    <h1>Bienvenido, {{ usuario.nombre }} {{ usuario.apellidos }}</h1>
    <p>CURP: {{ usuario.curp }}</p>
    <p>Correo: {{ usuario.correo }}</p>
    <a href="{% url 'logout' %}">Cerrar Sesión</a>

{% endblock %}

{% block content %}
<div class="container mt-5">
    <table class="table table-bordered">
        <tbody>
            <tr>
                <!-- Celda para la imagen de perfil -->
                <td rowspan="4" class="text-center" style="width: 20%;">
                    <img src="{{ usuario.imagen }}" alt="Imagen de perfil" class="img-fluid">
                </td>
                <!-- Celda para el nombre y apellidos -->
                <td class="fw-bold">Nombre:</td>
                <td>{{ usuario.nombre }} {{ usuario.apellidos }}</td>
            </tr>
            <tr>
                <!-- Celda para el CURP -->
                <td class="fw-bold">CURP:</td>
                <td>{{ usuario.curp }}</td>
            </tr>
            <tr>
                <!-- Celda para el correo electrónico -->
                <td class="fw-bold">Correo:</td>
                <td>{{ usuario.correo }}</td>
            </tr>
            <tr>
                <!-- Celda para el enlace de cerrar sesión -->
                <td colspan="2" class="text-center">
                    <a href="{% url 'logout' %}" class="btn btn-primary">Cerrar Sesión</a>
                </td>
            </tr>
        </tbody>
    </table>
</div>
{% endblock %}

<script>
    function verificarSesion() {
        fetch('{% url "verificar_sesion" %}')
            .then(response => response.json())
            .then(data => {
                if (!data.sesion_activa) {
                    // Si la sesión no está activa, redirige al login
                    window.location.href = '{% url "login" %}';
                }
            })
            .catch(error => console.error('Error al verificar la sesión:', error));
    }
    
    // Verificar el estado de la sesión cada 30 segundos
    setInterval(verificarSesion, 10000);
    </script>
    
</html>
